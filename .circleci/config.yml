version: 2
jobs:
  build:
    working_directory: /tmp/build
    docker:
      - image: tegud/circleci-nodejs-docker
    steps:
      - checkout
      - run:
          name: install serverless
          command: npm i -g serverless
      - run:
          name: test
          command: serverless config credentials --provider aws --key "$AWS_ACCESS_KEY_ID" --secret "$AWS_SECRET_ACCESS_KEY"
      - run:
          name: deploy
          command: serverless deploy
      - store_artifacts:
          path: /tmp/build/.serverless/
